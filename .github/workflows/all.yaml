name: "[dispatch] all"
on:
  workflow_dispatch:
        
jobs:
  get_repos:
    runs-on: ubuntu-latest
    outputs:
      repos: ${{ steps.set_repos.outputs.repos }}
    steps:
      - name: Set repos JSON
        id: set_repos
        run: |
          QUERY="q=org:GJ-playgroud+topic:core"
          TOKEN="${{ secrets.PAT_TOKEN  }}"
          API_URL="https://api.github.com/search/repositories"
          REPOS=$(curl -s -H "Authorization: token $TOKEN" "$API_URL?$QUERY" | jq -r '.items[] | .full_name')
          echo 'repos={\"repos\":'$REPOS'}' >> $GITHUB_OUTPUT
  echo:
    needs: ['get_repos']
    runs-on: ubuntu-latest
    steps:
      - name: echo
        run: echo ${{ fromJson(needs.get_repos.outputs.repos) }}
        
  build:
    needs: ['get_repos']
    runs-on: ubuntu-latest
    strategy:
      matrix:
        repo: ${{ fromJson(needs.get_repos.outputs.repos) }}
    steps:
      - name: Build
        run: |
          echo ${{ matrix.repo }}
